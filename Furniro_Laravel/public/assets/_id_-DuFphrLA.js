import{A as m,H as J,I as Z,J as y,L as me,M as fe,d as ee,N as ae,O as ve,P as te,Q as be,R as K,S as X,T as he,U as le,V as se,W as ye,l as Y,b as _,w as v,X as _e,c as q,Y as oe,e as $,Z as D,t,$ as ge,a0 as Ve,a1 as L,a2 as Be,a3 as ke,a4 as ne,F as T,D as R,g as O,x as H,_ as Ce,u as xe,r as f,a5 as ze,o as $e,f as d,B as qe,C as U,h as we,a6 as Fe,E as Ie,G as Ae,i as Se,z as Q,v as Ge}from"./index-CRIHzQGb.js";import{_ as Ue,a as Ne,b as De}from"./BFormTextarea.vue_vue_type_script_setup_true_lang-3ZSab3T0-DznhtSCH.js";const Me=p=>m(()=>{const a=J(p);return{"form-check":a.plain===!1&&a.button===!1&&a.hasDefaultSlot,"form-check-reverse":a.reverse===!0,"form-check-inline":a.inline===!0,"form-switch":a.switch===!0,[`form-control-${a.size}`]:a.size!==void 0&&a.size!=="md"&&a.button===!1}}),Le=p=>{const a=Z(y(p)),C=me(()=>a.value.state??null);return m(()=>[C.value,{"form-check-input":a.value.plain===!1&&a.value.button===!1,"btn-check":a.value.button===!0}])},Te=p=>m(()=>{const a=J(p);return{"form-check-label":a.plain===!1&&a.button===!1,btn:a.button===!0,[`btn-${a.buttonVariant}`]:a.button===!0&&a.buttonVariant!==void 0&&a.buttonVariant!==null,[`btn-${a.size}`]:a.button&&a.size&&a.size!=="md"}}),Re=p=>{const a=Z(y(p)),C=fe(()=>a.value.ariaInvalid,()=>a.value.state);return m(()=>({"aria-invalid":C.value,"aria-required":a.value.required===!0?!0:void 0}))},Oe=p=>m(()=>{const a=J(p);return{"was-validated":a.validated===!0,"btn-group":a.buttons===!0&&a.stacked===!1,"btn-group-vertical":a.stacked===!0&&a.buttons===!0,[`btn-group-${a.size}`]:a.size!==void 0}}),je=["id","disabled","required","name","form","aria-label","aria-labelledby","aria-required","value","true-value","false-value","indeterminate"],Ee=["for"],ue=ee({inheritAttrs:!1,__name:"BFormCheckbox",props:ae({ariaLabel:{default:void 0},ariaLabelledby:{default:void 0},autofocus:{type:Boolean,default:!1},button:{type:Boolean,default:!1},buttonGroup:{type:Boolean,default:!1},buttonVariant:{default:null},disabled:{type:Boolean,default:!1},form:{default:void 0},id:{default:void 0},inline:{type:Boolean,default:!1},name:{default:void 0},plain:{type:Boolean,default:!1},required:{type:Boolean,default:void 0},reverse:{type:Boolean,default:!1},size:{default:void 0},state:{type:[Boolean,null],default:null},switch:{type:Boolean,default:!1},uncheckedValue:{type:[Array,Set,String,Boolean,Object,Number,null],default:!1},wrapperAttrs:{default:void 0},inputClass:{default:void 0},value:{type:[String,Boolean,Array,Set,Object,Number,null],default:!0}},{modelValue:{type:[Array,Set,String,Boolean,Object,Number,null],default:void 0},modelModifiers:{},indeterminate:{type:Boolean,default:!1},indeterminateModifiers:{}}),emits:["update:modelValue","update:indeterminate"],setup(p,{expose:a}){const C=ve(),n=m(()=>{const{class:e,...u}=C;return{wrapperClass:e,inputAttrs:u}}),o=te(p,"BFormCheckbox"),V=be(),x=K(p,"modelValue"),F=K(p,"indeterminate"),z=X(()=>o.id,"form-check"),s=he(ne,null),B=le("_input"),{focused:A}=se(B,{initialValue:o.autofocus}),i=m(()=>!ye(V.default)),S=m({get:()=>s?s.modelValue.value:x.value,set:e=>{if(e!==void 0){if(F.value=!1,s!==null&&Array.isArray(e)){s.modelValue.value=e;return}x.value=e}}}),b=m(()=>!!(o.name??(s==null?void 0:s.name.value))&&(o.required||(s==null?void 0:s.required.value))),h=m(()=>o.buttonGroup||((s==null?void 0:s.buttons.value)??!1)),I=m(()=>({plain:o.plain||((s==null?void 0:s.plain.value)??!1),button:o.button||((s==null?void 0:s.buttons.value)??!1),inline:o.inline||((s==null?void 0:s.inline.value)??!1),reverse:o.reverse||((s==null?void 0:s.reverse.value)??!1),switch:o.switch||((s==null?void 0:s.switch.value)??!1),state:o.state===!0||o.state===!1?o.state:(s==null?void 0:s.state.value)??null,size:o.size??(s==null?void 0:s.size.value)??"md",buttonVariant:o.buttonVariant??(s==null?void 0:s.buttonVariant.value)??"secondary",hasDefaultSlot:i.value})),j=Me(I),E=m(()=>[j.value,n.value.wrapperClass]),P=Le(I),W=m(()=>[P.value,o.inputClass]),l=Te(I);return a({blur:()=>{A.value=!1},element:B,focus:()=>{A.value=!0}}),(e,u)=>(_(),Y(Be,D({skip:h.value},t(o).wrapperAttrs,{class:E.value}),{default:v(()=>{var c,G,g;return[_e($("input",D({id:t(z),ref:"_input","onUpdate:modelValue":u[0]||(u[0]=N=>S.value=N),class:W.value,type:"checkbox",disabled:t(o).disabled||((c=t(s))==null?void 0:c.disabled.value),required:b.value||void 0,name:t(o).name||((G=t(s))==null?void 0:G.name.value),form:t(o).form||((g=t(s))==null?void 0:g.form.value),"aria-label":t(o).ariaLabel,"aria-labelledby":t(o).ariaLabelledby,"aria-required":b.value||void 0,value:t(o).value,"true-value":t(o).value,"false-value":t(o).uncheckedValue,indeterminate:F.value||void 0},n.value.inputAttrs),null,16,je),[[ge,S.value]]),i.value||t(o).plain===!1?(_(),q("label",{key:0,for:t(z),class:Ve(t(l))},[L(e.$slots,"default")],10,Ee)):oe("",!0)]}),_:3},16,["skip","class"]))}}),Pe=["id"],We=ee({__name:"BFormCheckboxGroup",props:ae({ariaInvalid:{type:[Boolean,String],default:void 0},autofocus:{type:Boolean,default:!1},buttonVariant:{default:"secondary"},buttons:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},disabledField:{default:"disabled"},form:{default:void 0},id:{default:void 0},name:{default:void 0},options:{default:()=>[]},plain:{type:Boolean,default:!1},required:{type:Boolean,default:!1},reverse:{type:Boolean,default:!1},size:{default:"md"},stacked:{type:Boolean,default:!1},state:{type:[Boolean,null],default:null},switches:{type:Boolean,default:!1},textField:{default:"text"},validated:{type:Boolean,default:!1},valueField:{default:"value"}},{modelValue:{default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(p,{expose:a}){const n=te(p,"BFormCheckboxGroup"),w=K(p,"modelValue"),o=X(()=>n.id,"checkbox"),V=X(()=>n.name,"checkbox"),x=le("_element"),{focused:F}=se(x,{initialValue:n.autofocus});ke(ne,{modelValue:w,switch:y(()=>n.switches),buttonVariant:y(()=>n.buttonVariant),form:y(()=>n.form),name:V,state:y(()=>n.state),plain:y(()=>n.plain),size:y(()=>n.size),inline:y(()=>!n.stacked),reverse:y(()=>n.reverse),required:y(()=>n.required),buttons:y(()=>n.buttons),disabled:y(()=>n.disabled)});const z=m(()=>n.options.map(i=>typeof i=="string"||typeof i=="number"?{value:i,disabled:n.disabled,text:i.toString()}:{...i,value:i[n.valueField],disabled:i[n.disabledField],text:i[n.textField]})),s=m(()=>({required:n.required,ariaInvalid:n.ariaInvalid,state:n.state,validated:n.validated,buttons:n.buttons,stacked:n.stacked,size:n.size})),B=Re(s),A=Oe(s);return a({blur:()=>{F.value=!1},focus:()=>{F.value=!0}}),(i,S)=>(_(),q("div",D(t(B),{id:t(o),ref:"_element",role:"group",class:[t(A),"bv-no-focus-ring"],tabindex:"-1"}),[L(i.$slots,"first"),(_(!0),q(T,null,R(z.value,(b,h)=>(_(),Y(ue,D({key:h,ref_for:!0},b),{default:v(()=>[L(i.$slots,"option",D({ref_for:!0},b),()=>[O(H(b.text),1)])]),_:2},1040))),128)),L(i.$slots,"default")],16,Pe))}}),Qe={key:0},Ke=["src"],Xe={class:"d-flex flex-wrap gap-2"},He=["src"],Je=["onClick"],Ye={label:"Quantity",class:"my-2"},Ze={__name:"[id]",setup(p){const C=xe().params.id,n=Ge(),w=f(""),o=f(""),V=f(""),x=f(""),F=f(""),z=f(""),s=f(null),B=f([]),A=f(""),i=f([]),S=f([]),b=f([]),h=f([]),I=f(!1),j=async()=>{try{const l=await Q.get(`/api/edit/${C}`);w.value=l.data.product,V.value=l.data.price,x.value=l.data.price_sale,F.value=l.data.quantity,o.value=l.data.intro,z.value=l.data.badge;const e=l.data.sizes||[],u=l.data.size_quantities||[];S.value=l.data.all_sizes||[],b.value=e.filter((g,N)=>Number(u[N])>0),l.data.sizes&&l.data.size_quantities&&(h.value=l.data.sizes.map((g,N)=>({size:g,quantity:Number(u[N])||0})));const c=l.data.image;A.value=c.startsWith("http")?c:`http://localhost:8000/storage/${c}`;const G=l.data.addimage;i.value=Array.isArray(G)?G.map(g=>g.startsWith("http")?g:`http://localhost:8000/storage/${g}`):[]}catch(l){console.error("Lỗi khi lấy dữ liệu sản phẩm:",l)}};ze(b,l=>{h.value.length&&l.length===h.value.length||(h.value=l.map(e=>{const u=h.value.find(c=>c.size===e);return{size:e,quantity:u?u.quantity:0}}),I.value=l.length===S.value.length)});const E=l=>{b.value=l?[...S.value]:[]},P=async(l,e)=>{try{const u=l.replace("http://localhost:8000/storage/","");await Q.post("/api/delete-extra-image",{product_id:C,image:u}),i.value.splice(e,1)}catch(u){console.error("Không thể xoá ảnh phụ:",u),alert("Xoá ảnh phụ thất bại")}},W=async()=>{if(!w.value.trim()){alert("⚠ Tên sản phẩm không được để trống");return}if(!V.value||isNaN(Number(V.value))){alert("⚠ Giá sản phẩm phải là số hợp lệ");return}const l=new FormData;l.append("product",w.value),l.append("intro",o.value),l.append("badge",z.value||""),l.append("price",V.value),l.append("price_sale",x.value||""),l.append("quantity",F.value||""),s.value&&l.append("image",s.value),B.value.forEach(e=>{e&&l.append("addimage[]",e)}),h.value.forEach((e,u)=>{l.append(`sizes[${u}][size]`,e.size),l.append(`sizes[${u}][quantity]`,e.quantity)}),l.append("_method","PUT");try{await Q.post(`/api/edit/${C}`,l,{headers:{"Content-Type":"multipart/form-data"}}),alert(" Cập nhật sản phẩm thành công"),n.push("/admin/adminshop")}catch(e){console.error("Lỗi cập nhật:",e),alert(" Cập nhật thất bại")}};return $e(j),(l,e)=>{const u=qe,c=Ue,G=Ne,g=we,N=De,re=ue,de=We,ie=Fe,pe=Ae,ce=Se;return _(),Y(ce,null,{default:v(()=>[d(pe,{onSubmit:Ie(W,["prevent"])},{default:v(()=>[d(c,{label:"product",class:"my-2"},{default:v(()=>[d(u,{modelValue:t(w),"onUpdate:modelValue":e[0]||(e[0]=r=>U(w)?w.value=r:null),placeholder:"Tên sản phẩm"},null,8,["modelValue"])]),_:1}),d(G,{modelValue:t(s),"onUpdate:modelValue":e[1]||(e[1]=r=>U(s)?s.value=r:null),label:"Chọn ảnh chính",state:!!t(s),accept:"image/*"},null,8,["modelValue","state"]),t(A)?(_(),q("div",Qe,[e[9]||(e[9]=$("label",null,"Ảnh hiện tại:",-1)),e[10]||(e[10]=$("br",null,null,-1)),$("img",{src:t(A),style:{"max-width":"100px",border:"1px solid #ccc"}},null,8,Ke)])):oe("",!0),e[13]||(e[13]=$("label",{class:"mt-3"},"Ảnh phụ hiện tại:",-1)),e[14]||(e[14]=$("br",null,null,-1)),$("div",Xe,[(_(!0),q(T,null,R(t(i),(r,k)=>(_(),q("div",{key:k,style:{position:"relative"}},[$("img",{src:r,style:{"max-width":"100px",border:"1px solid #ccc"}},null,8,He),$("button",{onClick:M=>P(r,k),class:"delete"},"×",8,Je)]))),128))]),d(g,{class:"btn-warning mt-3 w-25 text-dark border",onClick:e[2]||(e[2]=r=>t(B).push(null))},{default:v(()=>e[11]||(e[11]=[O(" Thêm ảnh phụ ")])),_:1}),(_(!0),q(T,null,R(t(B),(r,k)=>(_(),q("div",{key:k,class:"mt-2"},[d(G,{modelValue:t(B)[k],"onUpdate:modelValue":M=>t(B)[k]=M,label:`Ảnh phụ ${k+1}`,state:!!t(B)[k],accept:"image/*"},null,8,["modelValue","onUpdate:modelValue","label","state"])]))),128)),d(c,{label:"Intro",class:"my-2"},{default:v(()=>[d(N,{modelValue:t(o),"onUpdate:modelValue":e[3]||(e[3]=r=>U(o)?o.value=r:null),placeholder:"Mô tả ngắn"},null,8,["modelValue"])]),_:1}),d(c,{label:"Giá",class:"my-2"},{default:v(()=>[d(u,{type:"number",modelValue:t(V),"onUpdate:modelValue":e[4]||(e[4]=r=>U(V)?V.value=r:null),placeholder:"Giá"},null,8,["modelValue"])]),_:1}),d(c,{label:"Giá sale",class:"my-2"},{default:v(()=>[d(u,{type:"number",modelValue:t(x),"onUpdate:modelValue":e[5]||(e[5]=r=>U(x)?x.value=r:null),placeholder:"Giá sale"},null,8,["modelValue"])]),_:1}),d(c,{label:"Badge",class:"my-2"},{default:v(()=>[d(u,{modelValue:t(z),"onUpdate:modelValue":e[6]||(e[6]=r=>U(z)?z.value=r:null),placeholder:"Badge"},null,8,["modelValue"])]),_:1}),d(ie,{label:"Chọn size:"},{default:v(()=>[d(re,{modelValue:t(I),"onUpdate:modelValue":[e[7]||(e[7]=r=>U(I)?I.value=r:null),E]},{default:v(()=>[O(H(t(I)?"Bỏ chọn tất cả":"Chọn tất cả"),1)]),_:1},8,["modelValue"]),d(de,{modelValue:t(b),"onUpdate:modelValue":e[8]||(e[8]=r=>U(b)?b.value=r:null),options:t(S),label:"Using options array:",class:"mt-2"},null,8,["modelValue","options"])]),_:1}),(_(!0),q(T,null,R(t(h),(r,k)=>(_(),q("div",{key:r.size,class:"mt-2"},[d(c,{label:`Số lượng cho size ${r.size}`},{default:v(()=>[d(u,{type:"number",min:"0",modelValue:t(h)[k].quantity,"onUpdate:modelValue":M=>t(h)[k].quantity=M,modelModifiers:{number:!0},placeholder:"Nhập số lượng"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]))),128)),$("div",Ye," Quantity: "+H(t(F)),1),d(g,{type:"submit",class:"btn-light w-25 text-dark border mt-3"},{default:v(()=>e[12]||(e[12]=[O("Cập nhật")])),_:1})]),_:1})]),_:1})}}},ta=Ce(Ze,[["__scopeId","data-v-9087c2a2"]]);export{ta as default};
